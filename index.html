<!DOCTYPE html>
<html>
<head>
	<title>Quick Start - Leaflet</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin=""></script>
	<link rel="stylesheet" href="MarkerCluster.css" />
	<link rel="stylesheet" href="MarkerCluster.Default.css" />	
	<script type="text/javascript" src="leaflet.markercluster-src.js"></script>

	</head>
<body>
<div id="mapid" style="width: 600px; height: 400px;"></div>
<script>
	var tiles = L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', 
		{
			maxZoom: 18,
			attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
			'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
			'Imagery © <a href="http://mapbox.com">Mapbox</a>',
			id: 'mapbox.streets'
		}),
		latlng = L.latLng(51.103, 8.549);

	var map = L.map('mapid', {center: latlng, zoom: 6, layers: [tiles]});

	
	
	var myRequest = new XMLHttpRequest();

	myRequest.open("GET", "data_average5min.json");

	myRequest.onload = function(){
		var data = myRequest.responseText;
		var json_data = JSON.parse(data);
		var markers = L.markerClusterGroup(
			{
			maxClusterRadius: 120,
			iconCreateFunction: function (cluster) {
				var child_markers = cluster.getAllChildMarkers();
				var sum = 0;
				var min = 0;
				var max = 10000000; //max was found by looping through all data
				var middle = 100000; //hard coded to see different colors on Germany map
				for (var i = 0; i < child_markers.length; i++) {
					var one_child = child_markers[i]
					value = one_child._popup._content
					console.log(value)
					sum += parseFloat(value);//markers[i].number; 
				}
				var average = sum/child_markers.length;
	
				var css_class = average > middle ? 'average_red' : 'average_green'
				return L.divIcon({ html: average, className: css_class, iconSize: L.point(40, 40) });
			},
			//Disable all of the defaults:
			spiderfyOnMaxZoom: false, showCoverageOnHover: false, zoomToBoundsOnClick: false
		}
		);
		var find_max=0;
		var find_min= 100;
		for (var i=0; i< 100; i++){

			var first_point = json_data[i];
			var first_sensor = first_point.sensordatavalues[0]
			var second_sensor = first_point.sensordatavalues[1]
			console.log(i)
			//console.log(first_sensor.value)
			//console.log(second_sensor.value)
			//console.log(first_point.location.latitude);
			//console.log(first_point.location.longitude);
		
			//var marker = new L.marker([
				//first_point.location.latitude,
				//first_point.location.longitude])
				//.addTo(mymap)
				//.bindPopup(
				//	"PM10 = "
				//	+first_sensor.value 
				//	+", PM2.5 = "
				//	+second_sensor.value
				//)
				//s.openPopup();

			var title = first_sensor.value
			find_max= Math.max(title, find_max)
			find_min= Math.min(title, find_min)
			var marker = L.marker(new L.LatLng(
				first_point.location.latitude, 
				first_point.location.longitude), 
				{ title: title});
			marker.bindPopup(title);
			markers.addLayer(marker);	
			//console.log(marker)
		};
		console.log("max = ", find_max)
		console.log("min = ", find_min)
		map.addLayer(markers);
	}

	myRequest.send();

	function getChildAverage(cluster){
		console.log(cluster)
		var average = 1;
		return average
	}









</script>







</body>

</html>